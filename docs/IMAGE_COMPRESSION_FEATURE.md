# ฟีเจอร์การบีบอัดรูปภาพ (Image Compression Feature)

## ภาพรวม
ฟีเจอร์การบีบอัดรูปภาพถูกเพิ่มเข้าไปในหน้า EquipmentAdd เพื่อลดขนาดไฟล์รูปภาพก่อนการอัพโหลด ซึ่งจะช่วยประหยัดพื้นที่จัดเก็บในฐานข้อมูลและเพิ่มความเร็วในการอัพโหลด

## คุณสมบัติหลัก

### 1. การบีบอัดอัตโนมัติ
- รูปภาพจะถูกบีบอัดอัตโนมัติเมื่ออัพโหลด
- ขนาดสูงสุด: 1920x1080 pixels
- คุณภาพ: 80% (ปรับได้)
- ขนาดไฟล์สูงสุด: 2MB

### 2. การแสดงผลการบีบอัด
- แสดงขนาดไฟล์ก่อนและหลังการบีบอัด
- แสดงเปอร์เซ็นต์การลดขนาด
- แสดงขนาดรูปภาพ (ความกว้าง x ความสูง)

### 3. การจัดการไฟล์
- รองรับการอัพโหลดหลายไฟล์พร้อมกัน
- การลากและวาง (Drag & Drop)
- การถ่ายภาพจากกล้อง
- การเลือกไฟล์จากเครื่อง

## ไฟล์ที่เกี่ยวข้อง

### 1. `src/lib/imageCompression.ts`
- คลาส `ImageCompression` สำหรับการบีบอัดรูปภาพ
- ฟังก์ชันการคำนวณขนาดใหม่
- ฟังก์ชันการแสดงขนาดไฟล์

### 2. `src/components/ui/image-upload.tsx`
- คอมโพเนนต์ `ImageUpload` ที่ได้รับการปรับปรุง
- การแสดงผลการบีบอัด
- การจัดการสถานะการบีบอัด

### 3. `src/pages/EquipmentAdd.tsx`
- การใช้งาน `ImageUpload` พร้อมตัวเลือกการบีบอัด

## การใช้งาน

### การตั้งค่าการบีบอัด
```tsx
<ImageUpload 
  equipmentId={equipmentId}
  maxImages={10}
  compressionOptions={{
    maxWidth: 1920,
    maxHeight: 1080,
    quality: 0.8,
    maxFileSize: 2 * 1024 * 1024 // 2MB
  }}
  onImagesUploaded={(images) => {
    // จัดการรูปภาพที่อัพโหลดแล้ว
  }}
/>
```

### ตัวเลือกการบีบอัด
- `maxWidth`: ความกว้างสูงสุดของรูปภาพ (pixels)
- `maxHeight`: ความสูงสูงสุดของรูปภาพ (pixels)
- `quality`: คุณภาพของรูปภาพ (0.1 - 1.0)
- `maxFileSize`: ขนาดไฟล์สูงสุด (bytes)

## ประโยชน์

### 1. ประหยัดพื้นที่จัดเก็บ
- ลดขนาดไฟล์ลง 50-80% โดยเฉลี่ย
- ประหยัดพื้นที่ใน Supabase Storage

### 2. เพิ่มความเร็ว
- อัพโหลดเร็วขึ้นเนื่องจากไฟล์เล็กลง
- โหลดรูปภาพในหน้าเว็บเร็วขึ้น

### 3. ประสบการณ์ผู้ใช้ที่ดีขึ้น
- การแสดงผลการบีบอัดแบบ Real-time
- การแจ้งเตือนเมื่อบีบอัดสำเร็จ
- การจัดการข้อผิดพลาดที่ดี

## การจัดการข้อผิดพลาด

### 1. การบีบอัดล้มเหลว
- ใช้ไฟล์ต้นฉบับแทน
- แจ้งเตือนผู้ใช้
- บันทึกข้อผิดพลาดใน Console

### 2. ไฟล์ไม่ถูกต้อง
- ตรวจสอบประเภทไฟล์
- ตรวจสอบขนาดไฟล์
- แจ้งเตือนผู้ใช้

## การปรับแต่งเพิ่มเติม

### 1. เปลี่ยนการตั้งค่าเริ่มต้น
แก้ไขใน `src/lib/imageCompression.ts`:
```typescript
private static defaultOptions: CompressionOptions = {
  maxWidth: 1920,
  maxHeight: 1080,
  quality: 0.8,
  maxFileSize: 2 * 1024 * 1024 // 2MB
}
```

### 2. เพิ่มรูปแบบไฟล์ที่รองรับ
แก้ไขใน `src/services/imageService.ts`:
```typescript
const validTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp']
```

## การทดสอบ

### 1. ทดสอบการบีบอัด
- อัพโหลดรูปภาพขนาดใหญ่ (5MB+)
- ตรวจสอบว่าขนาดลดลง
- ตรวจสอบคุณภาพยังคงดี

### 2. ทดสอบการแสดงผล
- ตรวจสอบการแสดงขนาดไฟล์
- ตรวจสอบการแสดงเปอร์เซ็นต์การบีบอัด
- ตรวจสอบการแสดงขนาดรูปภาพ

### 3. ทดสอบการจัดการข้อผิดพลาด
- อัพโหลดไฟล์ที่ไม่ใช่รูปภาพ
- อัพโหลดไฟล์ขนาดใหญ่มาก
- ตรวจสอบการแจ้งเตือน

## อนาคต

### 1. ฟีเจอร์ที่อาจเพิ่ม
- การเลือกคุณภาพการบีบอัด
- การแสดงตัวอย่างก่อนบีบอัด
- การบีบอัดแบบ Progressive
- การรองรับ WebP format

### 2. การปรับปรุงประสิทธิภาพ
- การบีบอัดแบบ Web Workers
- การบีบอัดแบบ Streaming
- การใช้ WebAssembly สำหรับการบีบอัด 